<!DOCTYPE html>
<html>
  <script src='https://d3js.org/d3.v5.min.js'></script>
  <body onload='init()'>
    <svg>
    </svg>
<script>
      async function init() {
        data = await d3.csv("https://flunky.github.io/cars2017.csv");
        //console.log(data);
        
        // JSON of number of cylinders: number of occurances in dataset
        var cylinderTally = data.reduce(function(acc, car) {
          if (!acc[parseInt(car.EngineCylinders)])
            acc[parseInt(car.EngineCylinders)] = Number(1);
          else
            acc[car.EngineCylinders]++;   
          return acc;
        }, {});
        console.log(cylinderTally)
        
        // returns the data d, filtered for only those cars with cylinders cyl
        function getData(cyl, d){
        let newData = d.filter((item)=>item.EngineCylinders === cyl);
          return newData
        }
        // console.log(getData("8", data))
        
        var paddingAroundChart = 50;
        var canvasWidth = 400;
        var canvasHeight = 400;
        var axisFontSize = 18;
        var engineSizes = [0,2,3,4,6,8,10,12];
        var engineSizeCounts = [10,1,4,52,39,30,3,7];
        var paddingAroundBars = 0;
        var myFont = "sans-sarif";
        
        // Canvas
        d3.select("svg")
        .attr("width", canvasWidth)
        .attr("height", canvasHeight)
        .attr("id", "scatter-plot");
        
        // Scatter plot
        cityMPG_scale = d3.scaleLog().base(10).domain([10,150]).range([0,canvasWidth - 2*paddingAroundChart]);
        hwyMPG_scale = d3.scaleLog().base(10).domain([10,150]).range([canvasHeight - 2*paddingAroundChart,0]);
        
        // scatter plot
        d3.select("#scatter-plot")
          .append("g")
            .attr("transform", "translate(" + paddingAroundChart + "," + paddingAroundChart + ")")
            .attr("id", "chart-field")
            .selectAll("circle")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function(d, i) {return cityMPG_scale(d.AverageCityMPG);})
            .attr("cy", function(d, i) {return hwyMPG_scale(d.AverageHighwayMPG);})
            .attr("r", function(d) {return Number(d.EngineCylinders)+2;})
            .style("fill", "lightblue")
            .style("opacity", 0.1)
            .style("stroke", "black");
        
        // scatter -- y-axis
        d3.select("#scatter-plot")
        .append("g")
        .attr("transform", "translate(" + paddingAroundChart +"," + paddingAroundChart +")")
        .call(d3.axisLeft(hwyMPG_scale)
              .tickFormat(d3.format("1.0s"))
              .tickValues([10,20,50,100])
             )
        .attr("font-family", myFont);
        
        // scatter -- y-axis title
        d3.select("#scatter-plot")
        .append("text")
        .attr("class", "y label")
        .attr("text-anchor", "middle")
        .attr("y", paddingAroundChart*2/5)
        .attr("x", -(canvasHeight/2))
        .attr("transform", "rotate(-90)")
          .attr("font-size", axisFontSize)
        .text("Average Highway MPG")
        .attr("font-family", myFont);
        
        
        // scatter -- x-axis
        d3.select("#scatter-plot")
        .append("g")
        .attr("transform", "translate(" + paddingAroundChart +"," + (canvasHeight - paddingAroundChart)  +")")
        .call(d3.axisBottom(cityMPG_scale)
              .tickFormat(d3.format("1.0s"))
              .tickValues([10,20,50,100]))
        .attr("font-family", myFont);
        
        // scatter -- x-axis title
        d3.select("#scatter-plot")
        .append("text")
        .attr("class", "x label")
        .attr("text-anchor", "middle")
        .attr("x", canvasWidth / 2)
        .attr("y", canvasHeight - 10)
        .attr("font-size", axisFontSize)
        .text("Average City MPG")
        .attr("font-family", myFont);
        
        // scatter -- prompt
        d3.select("#scatter-plot")
        .append("text")
        .attr("class", "scatter prompt")
        .attr("text-anchor", "start")
        .attr("y", 100)
        .attr("x", 75)
          .attr("font-size", axisFontSize)
        .text("Click in chart to return")
        .attr("font-family", myFont);
        
        // new canvas for bar chart
        d3.select("body")
          .append("svg")
          .attr("id", "bar-chart")
          .attr("width", canvasWidth)
          .attr("height", canvasHeight)
        
        // Bar chart scales
        bar_x_scale = d3.scaleBand().domain([0,2,3,4,6,8,10,12]).range([0,canvasWidth - 2*paddingAroundChart]);
        bar_y_scale = d3.scaleLinear().domain([0,52]).range([canvasHeight - 2*paddingAroundChart,0]);
        
        d3.select("#bar-chart")
          .append("g")
          .attr("transform", "translate(" + paddingAroundChart + "," + paddingAroundChart + ")")
          .selectAll("rect")
          .data(engineSizeCounts)
          .enter()
          .append("rect")
          .attr("x",function(d,i) {return i*((canvasWidth - 2*paddingAroundChart)/engineSizeCounts.length);})
          .attr("y", function(d) {return bar_y_scale(d)})
          .attr("width", (canvasWidth - 2*paddingAroundChart)/engineSizeCounts.length)
          .attr("height", function(d) {return canvasHeight - 2*paddingAroundChart - bar_y_scale(d);})
          .style("fill", "lightblue")
          .style("stroke", "black");
        
        d3.select("#bar-chart")
        .selectAll("text")
        .data(engineSizeCounts)
        .enter()
        .append("text")
        .text(function (d) {return d;})
        .attr("text-anchor","middle")
        .attr("x", function(d,i){return i*((canvasWidth-2*paddingAroundChart) / engineSizeCounts.length) + 67})
        .attr("y",function(d){return bar_y_scale(d) + paddingAroundChart - 5;})
        .attr("font-family", myFont);
         
        
        // bar -- x-axis
        d3.select("#bar-chart")
        .append("g")
        .attr("transform", "translate(" + paddingAroundChart +"," + (canvasHeight - paddingAroundChart)  +")")
        .call(d3.axisBottom(bar_x_scale).tickValues([0,2,3,4,6,8,10,12]));
        
        // bar -- x-axis title
        d3.select("#bar-chart")
        .append("text")
        .attr("class", "x label")
        .attr("text-anchor", "middle")
        .attr("x", canvasWidth / 2)
        .attr("y", canvasHeight - 10)
        .attr("font-size", axisFontSize)
        .text("Number of Cylindars")
        .attr("font-family", myFont);
        
        
        // bar -- y-axis
        d3.select("#bar-chart")
        .append("g")
        .attr("transform", "translate(" + paddingAroundChart +"," + paddingAroundChart +")")
        .call(d3.axisLeft(bar_y_scale));
        
        // bar -- y-axis title
        d3.select("#bar-chart")
        .append("text")
        .attr("class", "y label")
        .attr("text-anchor", "middle")
        .attr("y", paddingAroundChart*2/5)
        .attr("x", -(canvasHeight/2))
        .attr("transform", "rotate(-90)")
          .attr("font-size", axisFontSize)
        .text("Number of Cars in Dataset")
        .attr("font-family", myFont);
        
        // bar -- prompt
        d3.select("#bar-chart")
        .append("text")
        .attr("class", "bar prompt")
        .attr("text-anchor", "start")
        .attr("y", 100)
        .attr("x", 250)
          .attr("font-size", axisFontSize)
        .text("Click bars for more")
        .attr("font-family", myFont);
          
        
      }
    </script>
  </body>


</html>
